<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contato e Den√∫ncia</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar">
        <div class="nav-links">
            <a href="index.html" class="nav-item">Manifesto</a>
            <a href="mural.html" class="nav-item">Mural</a>
            <a href="lei.html" class="nav-item">Lei</a>
            <a href="contato.html" class="nav-item">Contato</a>
        </div>
        <div class="nav-auth">
            <a href="#" class="login-btn">LOGIN STEAM</a>
        </div>
    </nav>

    <header class="main-header">
        <h1>VIROU ALVO? <span class="orange">N√ÉO SE CALE.</span></h1>
        <p>Saiba como denunciar e onde buscar apoio jur√≠dico.</p>
    </header>

    <main class="grid-contato">
        <section class="canais-oficiais">
            <h2 class="orange">CANAIS OFICIAIS</h2>
            <p>Para puni√ß√£o legal e criminal, recorra a estes √≥rg√£os:</p>
            
            <div class="canal-card">
                <h3>Delegacia de Crimes Raciais (DECRADI)</h3>
                <p>Busque a delegacia especializada do seu estado. Se n√£o houver, utilize a <strong>Delegacia Eletr√¥nica</strong> para registrar o B.O. online.</p>
            </div>

            <div class="canal-card">
                <h3>SaferNet Brasil</h3>
                <p>Refer√™ncia nacional em den√∫ncias de crimes de √≥dio na internet. <br> 
                <a href="https://new.safernet.org.br/denuncie" target="_blank">denuncia.safernet.org.br</a></p>
            </div>

            <div class="canal-card">
                <h3>Minist√©rio P√∫blico Federal</h3>
                <p>Voc√™ pode formalizar uma den√∫ncia diretamente ao MPF atrav√©s da <strong>Sala de Atendimento ao Cidad√£o</strong>.</p>
            </div>
        </section>

        <section class="envio-mural">
            <h2 class="orange">ENVIE PARA O MURAL</h2>
            <p>Ajude-nos a documentar a toxicidade. Envie provas de racismo no CS2. √â An√¥nimo e seguro !  </p>
            
            <form id="reportForm" class="form-contato">
                <input type="text" id="reporter" placeholder="Seu Nick ou E-mail" required>
                <input type="text" id="offender_steam_id" placeholder="SteamID do Infrator" required>
                
                <div class="input-group">
                    <label for="mensagem">DESCRI√á√ÉO DOS FATOS</label>
                    <textarea id="mensagem" name="mensagem" placeholder="Descreva o ocorrido com detalhes..." required></textarea>
                </div>

                <div class="file-upload-wrapper">
                    <label for="arquivo" class="btn-arquivo">
                        <span class="icon">üìÅ</span> ANEXAR PROVAS
                    </label>
                    <input type="file" id="arquivo" name="arquivo" hidden multiple>
                    <span id="file-name">Nenhum arquivo selecionado</span>
                </div>

                <button type="submit" class="send-btn">ENVIAR DEN√öNCIA</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2026 Projeto Independente de Combate √† Toxicidade.</p>
        <p>Este site n√£o possui v√≠nculo com a Valve Corporation ou Steam.</p>
    </footer>

    <script>
        const reportForm = document.getElementById('reportForm');
        const inputArquivo = document.getElementById('arquivo');
        const labelTexto = document.getElementById('file-name');

        // PARA TRANSFORMAR A IMAGEM                             !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        //  
        inputArquivo.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                let nomes = Array.from(this.files).map(f => f.name);
                labelTexto.innerText = nomes.length === 1 ? "Selecionado: " + nomes[0] : nomes.length + " arquivos selecionados";
                labelTexto.style.color = "#00ff00"; 
            } else {
                labelTexto.innerText = "Nenhum arquivo selecionado";
                labelTexto.style.color = "#888"; 
            }
        });

        // LOG de envio
        reportForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            let imagemBase64 = null;
            
            // se tiver arquivo converte
            if (inputArquivo.files.length > 0) {
                try {
                    imagemBase64 = await toBase64(inputArquivo.files[0]);
                } catch (err) {
                    console.error("Erro na convers√£o da imagem:", err);
                }
            }

            const formData = {
                reporter: document.getElementById('reporter').value,
                offender_steam_id: document.getElementById('offender_steam_id').value,
                description: document.getElementById('mensagem').value,
                image: imagemBase64 // para a coluna 'image' do Supabase
            };

            try {
                const response = await fetch('http://localhost:5000/reports', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('‚úÖ Den√∫ncia e imagem enviadas ao Mural com sucesso!');
                    reportForm.reset();
                    labelTexto.innerText = "Nenhum arquivo selecionado";
                    labelTexto.style.color = "#888";
                } else {
                    alert('‚ùå Erro ao enviar den√∫ncia. Verifique se a coluna "image" existe no Supabase.');
                }
            } catch (error) {
                console.error('Erro de conex√£o:', error);
                alert('üö® Servidor offline! Rode "node server.js" no seu VS Code.');
            }
        });
    </script>
</body>
</html>